## 06-1 컨텍스트의 기초 개념 알아보기

3장에서 배운 프로퍼티와 state 는 부모 자식 컴포넌트가 연결된 상태에서 공유하는 데이터였지만, 컨텍스트는 부모와 자식 컴포넌트가 연결되어 있지 않아도 데이터를 공유할 수 있게 해준다. 따라서 컨텍스트는 보통 ‘데이터 공유 저장소’와 ‘데이터 전파’를 담당한다.

**컴포넌트의 구조와 데이터 흐름 이해하기**

컴포넌트는 다음과 같은 트리 구조 형태를 띠고 있다. 상위 컴포넌트의 데이터가 하위 컴포넌트로 전달될 때 프로퍼티를 사용한다.

![image](https://github.com/al1kite/dev-books-i-ever-read/assets/102217402/093036b3-9d95-4f4f-a262-76c724fd4fc0)

그림을 보면 HomePageComponent는 최상위 컴포넌트이고 Button 컴포넌트는 최하위 컴포넌트이다. 만약 data 프로퍼티를 HomePageComponent 에서 Button 컴포넌트로 전달 시 저 과정을 거쳐야 한다. 그런데 data 프로퍼티는 모든 컴포넌트에서 사용되지 않을 수도 있고 전달 과정에서 누락될 수도 있는데 그럴 시 리액트 앱에 오류가 발생한다.

**관찰자 패턴 도입하기**

이를 위해 도입한 디자인 패턴이 관찰자 패턴이다.

관찰자 패턴이란 ‘데이터는 공급자가 관리하고 관찰자는 공급자를 구독하여 데이터를 얻는 방식’을 말한다. 즉 관찰자 패턴을 도입하면 공급자와 관찰자가 서로 역할을 분리해 데이터를 관찰하게 된다. 공급자는 데이터 보관, 데이터 변경, 소비자에게 데이터를 공급하는 역할을 하고,

관찰자 (소비자) 는 공급자를 구독해 데이터를 소비하는 역할을 담당한다.

다음은 소비자 패턴을 이용해 앞에 있는 컴포넌트 구조를 수정한 것이다.


<p style="text-align: center">
<img width="400" src="https://github.com/al1kite/dev-books-i-ever-read/assets/102217402/34bca415-0fb2-47e8-bb4b-3e07f5aa8333">
</p>


공급자와 소비자가 추가되면서 데이터가 모든 컴포넌트를 거치지 않게 되었다.

이를 컴포넌트 간의 자료 의존성이 없어졌다고 이야기 한다. 이런 흐름을 만들어주는 기술이 컨텍스트이다.

바뀐 구조를 보면 공급자는 HomePageComponent 하위에 포함되어 있고 소비자는 하이어오더 컴포넌트 (Button 컴포넌트를 재활용)이며 RowCComponent 하위에 포함되어 있다.

**공급자와 소비자의 관계**

- 소비자는 공급자보다 낮은 계층에 있어야 한다

소비자는 상위에 정의되어 있는 공급자만 구독할 수 있고 소비자가 공급자보다 상위에 있으면 구독할 수 없다.

- 소비자는 공급자가 제공하는 콜백 함수로 데이터를 변경할 수 있다

소비자는 공급자의 데이터를 변경할 수도 있다. 단 소비자가 공급자의 데이터를 변경할 때는 ‘공급자의 데이터에 직접 접근해 변경하는 것’ 이 아닌 ‘공급자로부터 데이터 변경을 위한 콜백 함수를 받아 데이터 변경을 요청’ 해야 한다.

![image](https://github.com/al1kite/dev-books-i-ever-read/assets/102217402/005645b5-4817-45a6-9858-dc7116bb638a)

소비자는 콜백 함수에 GrandChild 의 data를 인자로 전달해 공급자의 데이터를 변경할 수 있다. 즉 소비자는 공급자가 전달한 콜백 함수로 데이터 변경을 요청하는 셈이다.

공급자의 데이터가 변경되었으므로 소비자와 동일하게 맞추는 패턴이 이루어진다. 이러한 데이터 흐름을 Data Down, Action Up (데이터는 아래로, 변경 요청은 위로)의 앞을자를 따 DDAU 라고 부른다. 이와 같은 단방향 데이터 흐름은 변경된 데이터의 일관성을 유지하는데 매우 효과적이다.

## 06-2 컨텍스트 제대로 사용하기

06-1 에서는 소비자가 하나의 공급자 데이터를 구독했지만 실무에서는 하나의 소비자가 두 개 이상의 공급자 데이터를 함께 참조하는 경우도 많다. 여기서는 소비자가 여러 개의 공급자 데이터를 구독하는 다양한 방법을 알아볼 예정. 가장 먼저 알아볼 방법은 상이한 공급자 데이터가 같은 이름을 가졌을 때 이로 인한 충돌을 방지하는 방법.

**중복 공급자 개념 살펴보기**

만약 2개의 방송국이 같은 주파수로 라디오 방송을 송출한다면 청취자는 더 가까운 방송국의 라디오를 청취하게 된다. 공급자도 비슷한 개념으로 소비자에게 데이터를 전달한다. 즉, 공급자 A와 B가 전달하는 데이터의 이름이 같다면 소비자는 더 가까운 공급자의 데이터를 수신한다.

- 커링으로 중복 공급자 문제 해결하기

앞서 소개한 문제를 해결하는 방법은 ‘커링을 도입하는 것’이다. 키 이름을 인자로 받아 원하는 공급자의 컨텍스트 데이터를 반환하는 커링 함수를 만들면 되는 것.